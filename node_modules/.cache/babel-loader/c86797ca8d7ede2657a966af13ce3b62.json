{"ast":null,"code":"import _objectSpread from \"/home/samman/Documents/laravel-project/react-git/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/home/samman/Documents/laravel-project/react-git/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/samman/Documents/laravel-project/react-git/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/samman/Documents/laravel-project/react-git/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/samman/Documents/laravel-project/react-git/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/samman/Documents/laravel-project/react-git/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/samman/Documents/laravel-project/react-git/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/samman/Documents/laravel-project/react-git/src/components/booksComponents/books.js\";\nimport React, { Component } from 'react';\nimport { Link } from \"react-router-dom\";\nimport axios from \"axios\";\nimport Categories from '../categoryComponents/categories';\nimport Search from './searchOrder';\nimport '../../Styles/main.css';\n\nvar BooksAdmin =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(BooksAdmin, _Component);\n\n  function BooksAdmin(props) {\n    var _this;\n\n    _classCallCheck(this, BooksAdmin);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(BooksAdmin).call(this, props));\n\n    _this.handelShowCategory = function (id) {\n      var bookShow = _this.state.books.filter(function (book) {\n        return book.category_id === id;\n      });\n\n      _this.setState({\n        bookShow: bookShow\n      });\n    };\n\n    _this.addToFavorite = function (id, userId, isFavorite) {\n      console.log(id + \"  \" + userId); //==========================================\n\n      isFavorite = true;\n\n      if (isFavorite) {\n        axios.post('http://127.0.0.1:8001/api/' + userId + '/favourite/' + id).then(function (res) {\n          if (res.data) {\n            console.log(res.data);\n          } else {\n            alert(\"invalid email or password\");\n          }\n        });\n      } else {\n        axios.delete('http://127.0.0.1:8001/api/' + userId + '/favourite/' + id).then(function (res) {\n          if (res.data) {\n            console.log(res.data);\n          } else {\n            alert(\"invalid email or password\");\n          }\n        });\n      }\n    };\n\n    _this.handelNumOfDays = function (e) {\n      var numOfDays = e.target.value;\n\n      _this.setState({\n        numOfDays: numOfDays\n      });\n    };\n\n    _this.handelLeased = function () {};\n\n    _this.state = {\n      books: [],\n      categories: [],\n      bookShow: [],\n      myFavorite: [],\n      user: [],\n      numOfDays: ''\n    };\n    return _this;\n  } //show category\n\n\n  _createClass(BooksAdmin, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var token = localStorage.getItem(\"TOKEN\");\n      var user = JSON.parse(localStorage.getItem(\"USER\")); //current user\n\n      this.setState({\n        user: user\n      });\n\n      if (!token) {\n        window.location = \"http://localhost:3000/\";\n      } //get all category\n\n\n      var allBook = axios.get('http://127.0.0.1:8001/api/categories/').then(function (res) {\n        var books = res.data.data.map(function (data) {\n          return data.books;\n        });\n        var allbooks = [];\n        books.forEach(function (book) {\n          allbooks = [].concat(_toConsumableArray(allbooks), _toConsumableArray(book));\n        });\n        var bookShow = allbooks.map(function (book) {\n          return _objectSpread({}, book, {\n            \"isFavourite\": false\n          });\n        });\n\n        if (res.data) {\n          _this2.setState({\n            categories: res.data.data,\n            bookShow: bookShow,\n            books: bookShow\n          });\n        } else {\n          alert(\"invalid email or password\");\n        }\n      }).catch(function (err) {\n        console.log(err);\n      }); //get favorite book for user\n\n      var myFavorite = axios.get('http://127.0.0.1:8001/api/' + user.id + '/favourites').then(function (res) {\n        if (res.data) {\n          _this2.setState({\n            myFavorite: res.data.data\n          });\n        } else {\n          alert(\"invalid email or password\");\n        }\n      }).catch(function (err) {\n        console.log(err);\n      }); // const allBook =\n      // axios.get('http://127.0.0.1:8001/api/books/')\n      //     .then(res => {\n      //         console.log(res.data);\n      //         if (res.data) {\n      //             let bookShow = res.data.map(book => {\n      //                 book.isFavourite = false;\n      //             });\n      //             this.setState({\n      //                 bookShow,\n      //                 books: bookShow,\n      //             });\n      //         } else {\n      //             alert(\"invalid email or password\");\n      //         }\n      //     });\n\n      Promise.all([myFavorite, allBook]).then(function (res) {\n        console.log(res);\n        var myFavorite = _this2.state.myFavorite;\n        var bookShowState = _this2.state.bookShow;\n        console.log(myFavorite);\n        console.log(bookShowState);\n        var bookShow = bookShowState.map(function (book) {\n          var mybook = myFavorite.map(function (fav) {\n            if (book.id === fav.id) {\n              console.log(\"=====\");\n              book.isFavourite = true;\n              return book;\n            } else {\n              return book;\n            }\n          });\n          return mybook;\n        });\n        bookShow = bookShow.map(function (book) {\n          return book[0];\n        });\n\n        _this2.setState({\n          bookShow: bookShow\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, React.createElement(Search, {\n        bookShow: this.state.bookShow,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }), React.createElement(Categories, {\n        catego: this.state.categories,\n        onClick: this.handelShowCategory,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row main\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, this.state.bookShow.map(function (book) {\n        return React.createElement(\"div\", {\n          className: \"thumb offset-2 col-3\",\n          key: book.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          style: {\n            width: 200,\n            height: 100\n          },\n          src: \"http://localhost:8001/\" + book.image,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185\n          },\n          __self: this\n        }, React.createElement(Link, {\n          to: '/books/' + book.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 186\n          },\n          __self: this\n        }, book.title)), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190\n          },\n          __self: this\n        }, book.description), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, book.NumberOfBook, \" copy available\")), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"row col-12\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 199\n          },\n          __self: this\n        }, book.isFavourite ? React.createElement(\"button\", {\n          className: \"col-12 btn btn-lg btn-primary\",\n          onClick: function onClick() {\n            return _this3.addToFavorite(book.id, _this3.state.user.id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201\n          },\n          __self: this\n        }, \"un favourite\") : React.createElement(\"button\", {\n          className: \"col-12 btn btn-lg btn-dark\",\n          onClick: function onClick() {\n            return _this3.addToFavorite(book.id, _this3.state.user.id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 207\n          },\n          __self: this\n        }, \"favourite\")), React.createElement(\"div\", {\n          className: \"col-12\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 214\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"number\",\n          value: _this3.state.numOfDays,\n          onChange: _this3.handelNumOfDays,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 215\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          className: \"col-12\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 219\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: \"btn btn-lg btn-primary\",\n          onClick: function onClick() {\n            return _this3.handelLeased(book.id, _this3.state.user.id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 220\n          },\n          __self: this\n        }, \"lesead\")))));\n      })));\n    }\n  }]);\n\n  return BooksAdmin;\n}(Component);\n\nexport default BooksAdmin;","map":{"version":3,"sources":["/home/samman/Documents/laravel-project/react-git/src/components/booksComponents/books.js"],"names":["React","Component","Link","axios","Categories","Search","BooksAdmin","props","handelShowCategory","id","bookShow","state","books","filter","book","category_id","setState","addToFavorite","userId","isFavorite","console","log","post","then","res","data","alert","delete","handelNumOfDays","e","numOfDays","target","value","handelLeased","categories","myFavorite","user","token","localStorage","getItem","JSON","parse","window","location","allBook","get","map","allbooks","forEach","catch","err","Promise","all","bookShowState","mybook","fav","isFavourite","width","height","image","title","description","NumberOfBook"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport {Link} from \"react-router-dom\";\nimport axios from \"axios\";\nimport Categories from '../categoryComponents/categories';\nimport Search from './searchOrder'\nimport '../../Styles/main.css'\n\nclass BooksAdmin extends Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            books: [],\n            categories: [],\n            bookShow: [],\n            myFavorite: [],\n            user: [],\n            numOfDays: '',\n        };\n    }\n\n    //show category\n    handelShowCategory = (id) => {\n        const bookShow = this.state.books.filter(book => {\n            return book.category_id === id;\n        });\n        this.setState({bookShow});\n    };\n\n\n    componentDidMount() {\n        let token = localStorage.getItem(\"TOKEN\");\n        let user = JSON.parse(localStorage.getItem(\"USER\"));\n        //current user\n        this.setState({\n            user,\n        });\n\n        if (!token) {\n            window.location = \"http://localhost:3000/\";\n        }\n\n        //get all category\n        const allBook = axios.get('http://127.0.0.1:8001/api/categories/')\n            .then(res => {\n                const books = res.data.data.map(data => {\n                    return data.books;\n\n                });\n                let allbooks = []\n                books.forEach(book => {\n                    allbooks = [...allbooks, ...book]\n                });\n                let bookShow = allbooks.map(book => {\n                    return {...book, \"isFavourite\": false};\n                });\n                if (res.data) {\n                    this.setState({\n                        categories: res.data.data,\n                        bookShow,\n                        books: bookShow,\n                    });\n                } else {\n                    alert(\"invalid email or password\");\n                }\n            }).catch(err => {\n                console.log(err);\n            });\n\n        //get favorite book for user\n        const myFavorite = axios.get('http://127.0.0.1:8001/api/' + user.id + '/favourites')\n            .then(res => {\n                if (res.data) {\n                    this.setState({\n                        myFavorite: res.data.data,\n                    });\n                } else {\n                    alert(\"invalid email or password\");\n                }\n            }).catch(err => {\n                console.log(err);\n            });\n\n        // const allBook =\n        // axios.get('http://127.0.0.1:8001/api/books/')\n        //     .then(res => {\n        //         console.log(res.data);\n        //         if (res.data) {\n        //             let bookShow = res.data.map(book => {\n        //                 book.isFavourite = false;\n        //             });\n        //             this.setState({\n        //                 bookShow,\n        //                 books: bookShow,\n        //             });\n        //         } else {\n        //             alert(\"invalid email or password\");\n        //         }\n        //     });\n\n        Promise.all([myFavorite, allBook]).then((res) => {\n            console.log(res);\n            const myFavorite = this.state.myFavorite;\n            const bookShowState = this.state.bookShow;\n            console.log(myFavorite);\n            console.log(bookShowState);\n            let bookShow = bookShowState.map(book => {\n                let mybook = myFavorite.map(fav => {\n                    if (book.id === fav.id) {\n                        console.log(\"=====\");\n                        book.isFavourite = true;\n                        return book;\n                    }else {\n                        return book;\n                    }\n                })\n                return mybook;\n            });\n\n            bookShow = bookShow.map(book=>{\n                return book[0];\n            });\n            this.setState({\n                bookShow,\n\n            });\n        });\n    }\n\n    addToFavorite = (id, userId, isFavorite) => {\n        console.log(id + \"  \" + userId);\n        //==========================================\n        isFavorite = true;\n        if (isFavorite) {\n            axios.post('http://127.0.0.1:8001/api/' + userId + '/favourite/' + id)\n                .then(res => {\n                    if (res.data) {\n                        console.log(res.data);\n                    } else {\n                        alert(\"invalid email or password\");\n                    }\n                });\n        } else {\n            axios.delete('http://127.0.0.1:8001/api/' + userId + '/favourite/' + id)\n                .then(res => {\n                    if (res.data) {\n                        console.log(res.data);\n                    } else {\n                        alert(\"invalid email or password\");\n                    }\n                });\n        }\n\n\n    };\n    handelNumOfDays = (e) => {\n        let numOfDays = e.target.value;\n        this.setState({numOfDays})\n    };\n    handelLeased = () => {\n\n    };\n\n\n    render() {\n        return (\n\n            <div>\n                <Search\n                    bookShow={this.state.bookShow}\n                />\n\n                <Categories\n                    catego={this.state.categories}\n                    onClick={this.handelShowCategory}\n                />\n                <div className='row main'>\n                    {this.state.bookShow.map((book) =>\n                        <div className=\"thumb offset-2 col-3\" key={book.id}>\n                            <div>\n                                <img style={{width: 200, height: 100}}\n                                     src={\"http://localhost:8001/\" + book.image}\n                                />\n                                <div>\n                                    <div>\n                                        <Link to={'/books/' + book.id}>\n                                            {book.title}\n                                        </Link>\n                                    </div>\n                                    <div>\n                                        {book.description}\n                                    </div>\n                                    <p>\n                                        {book.NumberOfBook} copy available\n                                    </p>\n                                </div>\n\n                                <div>\n                                    <div className='row col-12'>\n                                        {book.isFavourite ?\n                                            <button className='col-12 btn btn-lg btn-primary'\n                                                    onClick={() => this.addToFavorite(book.id, this.state.user.id)}\n                                            >\n                                                un favourite\n                                            </button>\n                                            :\n                                            <button className='col-12 btn btn-lg btn-dark'\n                                                    onClick={() => this.addToFavorite(book.id, this.state.user.id)}\n                                            >\n                                                favourite\n                                            </button>\n                                        }\n                                    </div>\n                                    <div className='col-12'>\n                                        <input type='number' value={this.state.numOfDays}\n                                               onChange={this.handelNumOfDays}\n                                        />\n                                    </div>\n                                    <div className='col-12'>\n                                        <button className='btn btn-lg btn-primary'\n                                                onClick={() => this.handelLeased(book.id, this.state.user.id)}\n                                        >\n                                            lesead\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default BooksAdmin;\n"]},"metadata":{},"sourceType":"module"}